# æç¤ºè¯æ•ˆæœå¯¹æ¯”åŠŸèƒ½ - å®ç°è®¡åˆ’

## ğŸ“‹ éœ€æ±‚åˆ†æ

### æ ¸å¿ƒåŠŸèƒ½
å®ç°ä¸€ä¸ª**å¤šç‰ˆæœ¬ç³»ç»Ÿæç¤ºè¯æ•ˆæœå¯¹æ¯”**åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ï¼š
1. é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„Promptç‰ˆæœ¬ï¼ˆä¼˜åŒ–å‰ vs ä¼˜åŒ–åï¼‰
2. ä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·è¾“å…¥æµ‹è¯•ä¸¤ä¸ªç‰ˆæœ¬
3. å·¦å³åˆ†å±å®æ—¶å¯¹æ¯”AIå“åº”æ•ˆæœ
4. æ”¯æŒå¤šè½®å¯¹è¯å’Œå†å²ç®¡ç†

### UIè®¾è®¡è¦æ±‚ï¼ˆåŸºäºæˆªå›¾ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æç¤ºè¯ä¼˜åŒ–                    AIæ¨¡å‹: é»˜è®¤  gemini-2.5-flash-lite â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ç³»ç»Ÿæç¤ºè¯ä¼˜åŒ–]  [ç”¨æˆ·æç¤ºè¯ä¼˜åŒ–]  [æ•ˆæœå¯¹æ¯”]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚    ä¼˜åŒ–å‰                â”‚  â”‚    ä¼˜åŒ–å                â”‚      â”‚
â”‚  â”‚  [ä¿å­˜] [å¯¼å‡º]           â”‚  â”‚  [ä¿å­˜] [å¯¼å‡º]           â”‚      â”‚
â”‚  â”‚                         â”‚  â”‚                         â”‚      â”‚
â”‚  â”‚    æš‚æ— å¯¹è¯             â”‚  â”‚    æš‚æ— å¯¹è¯             â”‚      â”‚
â”‚  â”‚                         â”‚  â”‚                         â”‚      â”‚
â”‚  â”‚                         â”‚  â”‚                         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚              [é‡ç½®]                        [è¿”å›]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Shift+Enteræ¢è¡Œ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æŠ€æœ¯æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‰æ‹© |
|------|------|------|------|------|
| æ–¹æ¡ˆA | ä¿®æ”¹ 03_Playground.py | å¤ç”¨ä»£ç  | åŠŸèƒ½è€¦åˆ | âŒ |
| æ–¹æ¡ˆB | æ–°å»º 04_Prompt_Comparison.py | æ¸…æ™°ç‹¬ç«‹ | ä»£ç é‡å¤ | âœ… |
| æ–¹æ¡ˆC | é‡æ„ 03 ä¸ºå¯¹æ¯”+å•æµ‹æ¨¡å¼ | åŠŸèƒ½é›†ä¸­ | å¤æ‚åº¦é«˜ | âŒ |

**æœ€ç»ˆé€‰æ‹©ï¼šæ–¹æ¡ˆB**
- åˆ›å»ºæ–°é¡µé¢ `pages/04_Prompt_Comparison.py`
- å¤ç”¨ç°æœ‰æœåŠ¡å±‚ä»£ç ï¼ˆPromptServiceã€LangChainClientç­‰ï¼‰
- ä¸å½±å“ç°æœ‰åŠŸèƒ½

---

## ğŸ“ æ¶æ„è®¾è®¡

### 1. æ–‡ä»¶ç»“æ„ï¼ˆæ–°å¢ï¼‰
```
pages/
â””â”€â”€ 04_Prompt_Comparison.py        # æ–°å»ºï¼šæç¤ºè¯å¯¹æ¯”é¡µé¢

app/services/
â””â”€â”€ comparison_service.py          # æ–°å»ºï¼šå¯¹æ¯”ä¸šåŠ¡é€»è¾‘ï¼ˆå¯é€‰ï¼‰

app/models/
â””â”€â”€ comparison.py                  # æ–°å»ºï¼šå¯¹æ¯”è®°å½•æ¨¡å‹ï¼ˆå¯é€‰ï¼ŒPhase 2ï¼‰
```

### 2. æ•°æ®æµè®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ“ä½œ                                                      â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ é€‰æ‹©å·¦ä¾§Prompt (ä¼˜åŒ–å‰) â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                  â”‚
    â”œâ”€ é€‰æ‹©å³ä¾§Prompt (ä¼˜åŒ–å) â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                  â”œâ”€â–º åˆå¹¶å˜é‡å…ƒæ•°æ®
    â”œâ”€ é…ç½®æ¨¡å‹å‚æ•°ï¼ˆå·¦/å³ï¼‰           â”‚   ç”Ÿæˆç»Ÿä¸€è¡¨å•
    â”‚                                  â”‚
    â””â”€ å¡«å……å˜é‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º PromptRenderService.render(left_prompt, variables)
         â”‚                     â†“
         â”‚              left_system_prompt
         â”‚
         â””â”€â–º PromptRenderService.render(right_prompt, variables)
                              â†“
                       right_system_prompt

    ç”¨æˆ·è¾“å…¥æ¶ˆæ¯
         â”‚
         â”œâ”€â–º LangChainClient(left_config).stream(left_messages)
         â”‚                     â†“
         â”‚              å·¦ä¾§å“åº”ï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰
         â”‚
         â””â”€â–º LangChainClient(right_config).stream(right_messages)
                              â†“
                       å³ä¾§å“åº”ï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰
```

### 3. Session Stateè®¾è®¡
```python
st.session_state = {
    # Prompté€‰æ‹©
    'left_prompt_name': str,          # å·¦ä¾§Promptåç§°
    'right_prompt_name': str,         # å³ä¾§Promptåç§°

    # æ¨¡å‹é…ç½®
    'left_model_name': str,           # å·¦ä¾§æ¨¡å‹
    'left_temperature': float,        # å·¦ä¾§æ¸©åº¦
    'right_model_name': str,          # å³ä¾§æ¨¡å‹
    'right_temperature': float,       # å³ä¾§æ¸©åº¦

    # å˜é‡æ•°æ®
    'comparison_variables': dict,     # åˆå¹¶åçš„å˜é‡å€¼

    # å¯¹è¯å†å²
    'left_chat_history': List[dict],  # å·¦ä¾§èŠå¤©è®°å½•
    'right_chat_history': List[dict], # å³ä¾§èŠå¤©è®°å½•

    # æ¸²æŸ“ç»“æœï¼ˆç¼“å­˜ï¼‰
    'left_rendered_prompt': str,      # å·¦ä¾§æ¸²æŸ“çš„ç³»ç»Ÿæç¤ºè¯
    'right_rendered_prompt': str,     # å³ä¾§æ¸²æŸ“çš„ç³»ç»Ÿæç¤ºè¯
}
```

---

## ğŸš€ å®æ–½æ­¥éª¤ï¼ˆTODO Listï¼‰

### Phase 1: åŸºç¡€UIæ­å»º âœ…

#### Step 1.1: åˆ›å»ºé¡µé¢æ–‡ä»¶
- [ ] åˆ›å»º `pages/04_Prompt_Comparison.py`
- [ ] è®¾ç½®é¡µé¢é…ç½®å’Œæ ‡é¢˜
- [ ] å¼•å…¥å¿…è¦çš„ä¾èµ–

#### Step 1.2: å¸ƒå±€è®¾è®¡
- [ ] åˆ›å»ºé¡¶éƒ¨é…ç½®åŒºåŸŸ
  - [ ] å·¦ä¾§Prompté€‰æ‹©å™¨
  - [ ] å³ä¾§Prompté€‰æ‹©å™¨
  - [ ] æ¨¡å‹é…ç½®ï¼ˆå¯æŠ˜å ï¼‰
- [ ] åˆ›å»ºä¸­é—´å¯¹æ¯”æ˜¾ç¤ºåŒºåŸŸ
  - [ ] ä½¿ç”¨ `st.columns([1, 1])` åˆ†å·¦å³ä¸¤æ 
  - [ ] æ¯æ åŒ…å«æ ‡é¢˜ã€ç³»ç»Ÿæç¤ºè¯å±•ç¤ºã€å¯¹è¯å†å²
- [ ] åˆ›å»ºåº•éƒ¨è¾“å…¥åŒºåŸŸ
  - [ ] ç»Ÿä¸€çš„å˜é‡è¾“å…¥è¡¨å•ï¼ˆå¯æŠ˜å ï¼‰
  - [ ] èŠå¤©è¾“å…¥æ¡†
  - [ ] æ§åˆ¶æŒ‰é’®ï¼ˆé‡ç½®ã€å¯¼å‡ºç­‰ï¼‰

#### Step 1.3: Session Stateåˆå§‹åŒ–
- [ ] ç¼–å†™ `init_comparison_session_state()` å‡½æ•°
- [ ] åˆå§‹åŒ–æ‰€æœ‰å¿…è¦çš„çŠ¶æ€å˜é‡
- [ ] å¤„ç†é¡µé¢åˆ·æ–°å’ŒçŠ¶æ€ä¿æŒ

---

### Phase 2: å˜é‡åˆå¹¶é€»è¾‘ âœ…

#### Step 2.1: å®ç°å˜é‡å…ƒæ•°æ®åˆå¹¶
- [ ] åˆ›å»º `merge_variables_meta()` å‡½æ•°
  - [ ] è¯»å–å·¦å³ä¸¤ä¸ªPromptçš„ `variables_meta`
  - [ ] åˆå¹¶ JSON Schema çš„ `properties`
  - [ ] å¤„ç†å˜é‡åå†²çªï¼ˆç›¸åŒåç§°ä½†ç±»å‹ä¸åŒï¼‰
  - [ ] ç”Ÿæˆåˆå¹¶åçš„ç»Ÿä¸€ schema

#### Step 2.2: åŠ¨æ€è¡¨å•ç”Ÿæˆ
- [ ] å¤ç”¨ `02_Prompt_Preview.py` çš„è¡¨å•ç”Ÿæˆé€»è¾‘
- [ ] æ ¹æ®åˆå¹¶åçš„ schema ç”Ÿæˆè¾“å…¥æ§ä»¶
- [ ] æ”¯æŒ8ç§æ•°æ®ç±»å‹ï¼ˆstring, number, boolean, array, objectç­‰ï¼‰
- [ ] åº”ç”¨é»˜è®¤å€¼å’ŒéªŒè¯è§„åˆ™

#### Step 2.3: å˜é‡éªŒè¯å’Œåˆ†å‘
- [ ] åˆ›å»º `distribute_variables()` å‡½æ•°
  - [ ] æ ¹æ®å·¦ä¾§Promptçš„ schema ç­›é€‰å¯¹åº”å˜é‡
  - [ ] æ ¹æ®å³ä¾§Promptçš„ schema ç­›é€‰å¯¹åº”å˜é‡
  - [ ] è¿”å›ä¸¤ä¸ªç‹¬ç«‹çš„å˜é‡å­—å…¸

---

### Phase 3: Promptæ¸²æŸ“ âœ…

#### Step 3.1: ç³»ç»Ÿæç¤ºè¯æ¸²æŸ“
- [ ] ä½¿ç”¨ `PromptRenderService.render()` æ¸²æŸ“å·¦ä¾§Prompt
- [ ] ä½¿ç”¨ `PromptRenderService.render()` æ¸²æŸ“å³ä¾§Prompt
- [ ] ç¼“å­˜æ¸²æŸ“ç»“æœåˆ° session_state
- [ ] åœ¨UIä¸­å±•ç¤ºæ¸²æŸ“åçš„ç³»ç»Ÿæç¤ºè¯ï¼ˆå¯æŠ˜å ï¼‰

#### Step 3.2: é”™è¯¯å¤„ç†
- [ ] æ•è·Jinja2æ¸²æŸ“é”™è¯¯
- [ ] æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
- [ ] å…è®¸ç”¨æˆ·ä¿®æ”¹å˜é‡åé‡è¯•

---

### Phase 4: LLMè°ƒç”¨å’Œæµå¼è¾“å‡º âœ…

#### Step 4.1: æ¶ˆæ¯æ„å»º
- [ ] åˆ›å»º `build_messages()` å‡½æ•°
  - [ ] æ„å»º SystemMessageï¼ˆæ¸²æŸ“åçš„ç³»ç»Ÿæç¤ºè¯ï¼‰
  - [ ] æ·»åŠ å†å²æ¶ˆæ¯ï¼ˆHumanMessage å’Œ AIMessageï¼‰
  - [ ] æ·»åŠ å½“å‰ç”¨æˆ·è¾“å…¥

#### Step 4.2: å¹¶è¡Œ/é¡ºåºè°ƒç”¨ç­–ç•¥
- [ ] **é¡ºåºè°ƒç”¨æ–¹æ¡ˆ**ï¼ˆæ¨èï¼ŒStreamlitå…¼å®¹æ€§å¥½ï¼‰
  - [ ] å…ˆè°ƒç”¨å·¦ä¾§LLMï¼Œæµå¼è¾“å‡ºåˆ°å·¦æ 
  - [ ] å†è°ƒç”¨å³ä¾§LLMï¼Œæµå¼è¾“å‡ºåˆ°å³æ 
- [ ] **å¹¶è¡Œè°ƒç”¨æ–¹æ¡ˆ**ï¼ˆå¯é€‰ï¼Œéœ€è¦é¢å¤–å¤„ç†ï¼‰
  - [ ] ä½¿ç”¨çº¿ç¨‹æ± å¹¶è¡Œè°ƒç”¨
  - [ ] éœ€è¦è‡ªå®šä¹‰æµå¼è¾“å‡ºUIç»„ä»¶

#### Step 4.3: å®ç°æµå¼è¾“å‡º
- [ ] å·¦ä¾§ï¼š`LangChainClient(left_config).stream(left_messages)`
- [ ] å³ä¾§ï¼š`LangChainClient(right_config).stream(right_messages)`
- [ ] ä½¿ç”¨ `st.write_stream()` å®æ—¶æ˜¾ç¤º
- [ ] ä¿å­˜å“åº”åˆ°å„è‡ªçš„ chat_history

---

### Phase 5: å¯¹è¯å†å²ç®¡ç† âœ…

#### Step 5.1: å†å²æ˜¾ç¤º
- [ ] ä½¿ç”¨ `st.chat_message()` æ¸²æŸ“å†å²æ¶ˆæ¯
- [ ] å·¦å³ä¸¤æ ç‹¬ç«‹æ˜¾ç¤ºå„è‡ªçš„å¯¹è¯
- [ ] æ˜¾ç¤ºæ—¶é—´æˆ³
- [ ] æ”¯æŒæ»šåŠ¨æŸ¥çœ‹

#### Step 5.2: å†å²æ“ä½œ
- [ ] å®ç°"é‡ç½®"æŒ‰é’®
  - [ ] æ¸…ç©ºå·¦ä¾§ chat_history
  - [ ] æ¸…ç©ºå³ä¾§ chat_history
  - [ ] ä¿ç•™Prompté€‰æ‹©å’Œå˜é‡é…ç½®
- [ ] å®ç°"æ¸…é™¤å•ä¾§"æŒ‰é’®ï¼ˆå¯é€‰ï¼‰

---

### Phase 6: é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰ ğŸ”®

#### Step 6.1: å¯¹æ¯”ç»“æœå¯¼å‡º
- [ ] åˆ›å»ºå¯¼å‡ºåŠŸèƒ½
  - [ ] å¯¼å‡ºä¸ºMarkdownæ ¼å¼
  - [ ] å¯¼å‡ºä¸ºJSONæ ¼å¼
  - [ ] åŒ…å«ï¼šPromptä¿¡æ¯ã€å˜é‡ã€å¯¹è¯å†å²ã€æ¨¡å‹é…ç½®

#### Step 6.2: å·®å¼‚é«˜äº®ï¼ˆè¿›é˜¶ï¼‰
- [ ] ä½¿ç”¨ difflib è®¡ç®—å“åº”å·®å¼‚
- [ ] åœ¨UIä¸­é«˜äº®æ˜¾ç¤ºä¸åŒéƒ¨åˆ†
- [ ] æä¾›"å¹¶æ’å¯¹æ¯”"å’Œ"ç»Ÿä¸€å¯¹æ¯”"è§†å›¾

#### Step 6.3: å¯¹æ¯”è®°å½•ä¿å­˜ï¼ˆéœ€æ•°æ®åº“æ‰©å±•ï¼‰
- [ ] åˆ›å»º `ComparisonSession` æ•°æ®æ¨¡å‹
- [ ] ä¿å­˜å¯¹æ¯”é…ç½®å’Œç»“æœåˆ°æ•°æ®åº“
- [ ] å®ç°å†å²å¯¹æ¯”è®°å½•æŸ¥çœ‹

---

## ğŸ“ æ ¸å¿ƒä»£ç æ¡†æ¶

### 1. é¡µé¢ä¸»ç»“æ„
```python
# pages/04_Prompt_Comparison.py

import streamlit as st
from app.ui.common import init_page, get_db, get_prompt_service, get_render_service
from app.llm.langchain_client import LangChainClient
# ... å…¶ä»–å¯¼å…¥

def init_comparison_session_state():
    """åˆå§‹åŒ–å¯¹æ¯”é¡µé¢çš„session state"""
    if 'left_prompt_name' not in st.session_state:
        st.session_state.left_prompt_name = None
    # ... åˆå§‹åŒ–å…¶ä»–çŠ¶æ€

def merge_variables_meta(left_meta, right_meta):
    """åˆå¹¶ä¸¤ä¸ªPromptçš„å˜é‡å…ƒæ•°æ®"""
    # å®ç°åˆå¹¶é€»è¾‘
    pass

def render_comparison_view():
    """æ¸²æŸ“å¯¹æ¯”è§†å›¾"""
    # 1. é¡¶éƒ¨é…ç½®åŒº
    render_config_section()

    # 2. å˜é‡è¾“å…¥åŒºï¼ˆå¯æŠ˜å ï¼‰
    render_variables_section()

    # 3. å¯¹æ¯”æ˜¾ç¤ºåŒºï¼ˆå·¦å³ä¸¤æ ï¼‰
    col_left, col_right = st.columns([1, 1])

    with col_left:
        render_left_panel()

    with col_right:
        render_right_panel()

    # 4. åº•éƒ¨è¾“å…¥åŒº
    render_chat_input()

def main():
    init_page("æç¤ºè¯æ•ˆæœå¯¹æ¯”")
    init_comparison_session_state()
    render_comparison_view()

if __name__ == "__main__":
    main()
```

### 2. å˜é‡åˆå¹¶å‡½æ•°
```python
def merge_variables_meta(left_meta: dict, right_meta: dict) -> dict:
    """
    åˆå¹¶ä¸¤ä¸ªPromptçš„å˜é‡å…ƒæ•°æ®

    ç­–ç•¥ï¼š
    1. å˜é‡åä¸å†²çªï¼šç›´æ¥åˆå¹¶
    2. å˜é‡åç›¸åŒä¸”ç±»å‹ç›¸åŒï¼šä¿ç•™ä¸€ä¸ªï¼ˆä½¿ç”¨å·¦ä¾§å®šä¹‰ï¼‰
    3. å˜é‡åç›¸åŒä½†ç±»å‹ä¸åŒï¼šé‡å‘½åä¸º {name}_left å’Œ {name}_right
    """
    merged_properties = {}
    conflicts = []

    left_props = left_meta.get("properties", {})
    right_props = right_meta.get("properties", {})

    # å¤„ç†å·¦ä¾§å˜é‡
    for name, schema in left_props.items():
        if name not in right_props:
            merged_properties[name] = schema
        elif right_props[name].get("type") == schema.get("type"):
            # ç±»å‹ç›¸åŒï¼Œä¿ç•™å·¦ä¾§å®šä¹‰
            merged_properties[name] = schema
        else:
            # ç±»å‹å†²çªï¼Œé‡å‘½å
            merged_properties[f"{name}_left"] = schema
            conflicts.append(name)

    # å¤„ç†å³ä¾§å˜é‡
    for name, schema in right_props.items():
        if name not in left_props:
            merged_properties[name] = schema
        elif name in conflicts:
            merged_properties[f"{name}_right"] = schema

    return {
        "type": "object",
        "properties": merged_properties,
        "conflicts": conflicts  # è®°å½•å†²çªçš„å˜é‡å
    }
```

### 3. LLMè°ƒç”¨å‡½æ•°
```python
def invoke_llm_comparison(
    left_prompt: str,
    right_prompt: str,
    user_input: str,
    left_history: list,
    right_history: list,
    left_config: dict,
    right_config: dict
):
    """
    å¹¶è¡Œæˆ–é¡ºåºè°ƒç”¨ä¸¤ä¸ªLLMè¿›è¡Œå¯¹æ¯”

    è¿”å›ï¼š
    - left_response: str
    - right_response: str
    """
    from langchain.schema import SystemMessage, HumanMessage, AIMessage

    # æ„å»ºå·¦ä¾§æ¶ˆæ¯
    left_messages = [SystemMessage(content=left_prompt)]
    for msg in left_history:
        if msg["role"] == "user":
            left_messages.append(HumanMessage(content=msg["content"]))
        else:
            left_messages.append(AIMessage(content=msg["content"]))
    left_messages.append(HumanMessage(content=user_input))

    # æ„å»ºå³ä¾§æ¶ˆæ¯ï¼ˆåŒç†ï¼‰
    right_messages = [SystemMessage(content=right_prompt)]
    # ... åŒä¸Š

    # è°ƒç”¨LLM
    left_client = LangChainClient(
        model_name=left_config['model_name'],
        temperature=left_config['temperature']
    )
    right_client = LangChainClient(
        model_name=right_config['model_name'],
        temperature=right_config['temperature']
    )

    # æµå¼è°ƒç”¨ï¼ˆé¡ºåºï¼‰
    col_left, col_right = st.columns([1, 1])

    with col_left:
        with st.chat_message("assistant"):
            left_response = st.write_stream(left_client.stream(left_messages))

    with col_right:
        with st.chat_message("assistant"):
            right_response = st.write_stream(right_client.stream(right_messages))

    return left_response, right_response
```

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯• `merge_variables_meta()` å‡½æ•°
  - [ ] æ— å†²çªæƒ…å†µ
  - [ ] ç±»å‹ç›¸åŒæƒ…å†µ
  - [ ] ç±»å‹å†²çªæƒ…å†µ

### é›†æˆæµ‹è¯•
- [ ] æµ‹è¯•å®Œæ•´å¯¹æ¯”æµç¨‹
  - [ ] é€‰æ‹©ä¸¤ä¸ªPrompt
  - [ ] å¡«å……å˜é‡
  - [ ] å‘é€æ¶ˆæ¯
  - [ ] éªŒè¯å“åº”

### UIæµ‹è¯•
- [ ] æµ‹è¯•å¸ƒå±€å“åº”å¼
- [ ] æµ‹è¯•æµå¼è¾“å‡ºæ˜¾ç¤º
- [ ] æµ‹è¯•é‡ç½®åŠŸèƒ½

---

## ğŸ“Š æˆåŠŸæ ‡å‡†

âœ… **åŠŸèƒ½å®Œæ•´æ€§**
- èƒ½å¤Ÿé€‰æ‹©ä¸¤ä¸ªä¸åŒçš„Prompt
- èƒ½å¤Ÿé…ç½®ç‹¬ç«‹çš„æ¨¡å‹å‚æ•°
- èƒ½å¤Ÿå®æ—¶å¯¹æ¯”AIå“åº”
- æ”¯æŒå¤šè½®å¯¹è¯

âœ… **ç”¨æˆ·ä½“éªŒ**
- UIå¸ƒå±€æ¸…æ™°ç¾è§‚
- æµå¼è¾“å‡ºæµç•…
- é”™è¯¯æç¤ºå‹å¥½
- æ“ä½œé€»è¾‘ç›´è§‚

âœ… **ä»£ç è´¨é‡**
- ä»£ç ç»“æ„æ¸…æ™°
- å¤ç”¨ç°æœ‰æœåŠ¡å±‚
- é”™è¯¯å¤„ç†å®Œå–„
- æ³¨é‡Šæ–‡æ¡£é½å…¨

---

## ğŸ“… æ—¶é—´ä¼°ç®—

| Phase | ä»»åŠ¡ | é¢„ä¼°æ—¶é—´ |
|-------|------|---------|
| Phase 1 | åŸºç¡€UIæ­å»º | 1-2å°æ—¶ |
| Phase 2 | å˜é‡åˆå¹¶é€»è¾‘ | 1å°æ—¶ |
| Phase 3 | Promptæ¸²æŸ“ | 0.5å°æ—¶ |
| Phase 4 | LLMè°ƒç”¨ | 1.5å°æ—¶ |
| Phase 5 | å¯¹è¯å†å²ç®¡ç† | 1å°æ—¶ |
| Phase 6 | é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰| 2-3å°æ—¶ |
| **æ€»è®¡** | **æ ¸å¿ƒåŠŸèƒ½** | **5-6å°æ—¶** |

---

## ğŸ”„ åç»­ä¼˜åŒ–æ–¹å‘

1. **æ€§èƒ½ä¼˜åŒ–**
   - å®ç°çœŸæ­£çš„å¹¶è¡ŒLLMè°ƒç”¨
   - æ·»åŠ å“åº”ç¼“å­˜æœºåˆ¶

2. **åŠŸèƒ½æ‰©å±•**
   - æ”¯æŒå¯¹æ¯”3ä¸ªä»¥ä¸Šçš„Prompt
   - æ·»åŠ è¯„åˆ†å’Œæ ‡æ³¨åŠŸèƒ½
   - å®ç°A/Bæµ‹è¯•ç»Ÿè®¡åˆ†æ

3. **æ•°æ®åˆ†æ**
   - è®°å½•å¯¹æ¯”æ•°æ®åˆ°æ•°æ®åº“
   - ç”Ÿæˆå¯¹æ¯”æ•ˆæœåˆ†ææŠ¥å‘Š
   - å¯è§†åŒ–å“åº”å·®å¼‚

---

## ğŸ“– å‚è€ƒèµ„æ–™

- Streamlitæ–‡æ¡£: https://docs.streamlit.io/
- LangChainæ–‡æ¡£: https://python.langchain.com/docs/
- ç°æœ‰ä»£ç å‚è€ƒ:
  - `pages/03_Playground.py` - èŠå¤©äº¤äº’å®ç°
  - `pages/02_Prompt_Preview.py` - å˜é‡è¡¨å•ç”Ÿæˆ
  - `app/services/template_engine.py` - Promptæ¸²æŸ“æœåŠ¡

---

**å¼€å§‹å®æ–½æ—¶é—´**: 2025-11-20
**é¢„è®¡å®Œæˆæ—¶é—´**: 2025-11-20 (æ ¸å¿ƒåŠŸèƒ½)
